{% extends 'finances/base.html' %}

{% block title %}–ú–æ–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏{% endblock %}

{% block content %}
<div class="balance">
    üí∞ –ë–∞–ª–∞–Ω—Å: <strong>{{ balance|floatformat:2 }} ‚ÇΩ</strong>
</div>
<p>
    üì• –î–æ—Ö–æ–¥—ã: {{ income|floatformat:2 }} ‚ÇΩ |
    üì§ –†–∞—Å—Ö–æ–¥—ã: {{ expense|floatformat:2 }} ‚ÇΩ |
    <a href="{% url 'finances:add_transaction' %}">‚ûï –î–æ–±–∞–≤–∏—Ç—å</a>
</p>

<div style="height: 300px; margin: 20px 0;">
    <canvas id="balanceChart"></canvas>
</div>

<ul>
{% for t in transactions %}
    <li>{{ t.date }} ‚Äî {{ t.category }}: {{ t.amount }} ‚ÇΩ</li>
{% empty %}
    <li>–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</li>
{% endfor %}
</ul>

{{ chart_data|json_script:"chart-data" }}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const el = document.getElementById('chart-data');
    if (!el) return;
    const data = JSON.parse(el.textContent);
    const canvas = document.getElementById('balanceChart');
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: { 
            labels: data.labels || ['–°–µ–≥–æ–¥–Ω—è'],
	    datasets: [{
		label: '–ë–∞–ª–∞–Ω—Å',
             	data: data.balance || [0],
            	borderColor: '#000',
            	tension: 0.3,
            	fill: true
            }],
	},
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { 
		legend: { display: false } 
	    }
        }
    });
});
</script>
{% endblock %}